#!/bin/sh
set -e

# Resolve symlink to find the actual hook directory
if [ -L "$0" ]; then
  HOOK_PATH=$(readlink "$0")
  SCRIPT_DIR=$(cd "$(dirname "$0")" && cd "$(dirname "$HOOK_PATH")" && pwd)
else
  SCRIPT_DIR=$(cd "$(dirname "$0")" && pwd)
fi

. "$SCRIPT_DIR/hook-lib.sh"

before_hook

"$SCRIPT_DIR/format.sh"

# Check if formatting changed anything
FORMAT_CHANGED=$(git diff --name-only --ignore-submodules || true)
if [ -n "$FORMAT_CHANGED" ]; then
  echo "The following files were modified by formatters:"
  echo "$FORMAT_CHANGED"
  echo "Please stage the changes and commit again."
  exit 1
fi

after_hook
exit 0
